#!/usr/bin/env bash
# Fan Control Configuration File
# Raspberry Pi 5 Fan Control System
#
# This file contains all configurable parameters for the fan control daemon.
# Modify values here instead of editing the main script.
#
# Temperature values are in degrees Celsius.

# ============================================================================
# TEMPERATURE THRESHOLDS
# ============================================================================

# CPU Fan Thresholds (Balanced Profile)
# State 0: < CPU_TEMP_STATE1
# State 1: CPU_TEMP_STATE1 to CPU_TEMP_STATE2
# State 2: CPU_TEMP_STATE2 to CPU_TEMP_STATE3
# State 3: CPU_TEMP_STATE3 to CPU_TEMP_STATE4
# State 4: >= CPU_TEMP_STATE4
CPU_TEMP_STATE1=50
CPU_TEMP_STATE2=60
CPU_TEMP_STATE3=70
CPU_TEMP_STATE4=80

# NVMe Fan Thresholds (Multi-level)
# Similar structure to CPU, each threshold triggers a new duty cycle level
NVME_TEMP_LEVEL1=50
NVME_TEMP_LEVEL2=60
NVME_TEMP_LEVEL3=70
NVME_TEMP_LEVEL4=80

# ============================================================================
# HYSTERESIS
# ============================================================================

# Hysteresis: Temperature must drop this many degrees below threshold
# before reducing fan speed. Prevents rapid oscillation at threshold boundaries.
HYSTERESIS=3

# ============================================================================
# PWM CONFIGURATION
# ============================================================================

# PWM period in nanoseconds (40000 = 25 kHz frequency)
PWM_PERIOD=40000

# NVMe Fan Duty Cycle Values (0-40000 range)
# Duty cycle determines PWM on-time, higher = faster fan
NVME_DUTY_OFF=0         # 0% - Fan off
NVME_DUTY_LOW=8000      # 20% - Low speed
NVME_DUTY_MED=16000     # 40% - Medium speed
NVME_DUTY_HIGH=24000    # 60% - High speed
NVME_DUTY_MAX=32000     # 80% - Maximum speed

# ============================================================================
# TIMING
# ============================================================================

# Loop interval: Seconds to wait between temperature checks
# Lower values = more responsive, higher CPU usage
# Higher values = less responsive, lower CPU usage
LOOP_INTERVAL=5

# ============================================================================
# LOGGING
# ============================================================================

# Directory where log files will be stored
LOG_DIR="/var/log/fan-control"

# Number of days to keep old log files
# Logs older than this will be automatically deleted
LOG_RETENTION_DAYS=5

# Debug mode: Set to 1 for verbose logging, 0 for normal operation
DEBUG_MODE=0

# ============================================================================
# HARDWARE PATHS
# ============================================================================

# PWM chip for NVMe fan control
PWM_CHIP="/sys/class/pwm/pwmchip1"
PWM_CHANNEL=0

# CPU fan thermal cooling device
CPU_COOLING_DEVICE="/sys/class/thermal/cooling_device0"

# Thermal zone for automatic control enable/disable
THERMAL_ZONE="/sys/class/thermal/thermal_zone0"

# ============================================================================
# ERROR HANDLING & SAFETY
# ============================================================================

# Maximum number of consecutive sensor read failures before entering emergency mode
MAX_SENSOR_FAILURES=3

# Emergency cooling settings (activated on sensor failures or thermal runaway)
EMERGENCY_CPU_STATE=4           # Maximum CPU fan speed
EMERGENCY_NVME_DUTY=32000       # 80% NVMe fan speed

# Critical temperature thresholds (triggers emergency mode)
CPU_CRITICAL_TEMP=90            # CPU critical temperature in Celsius
NVME_CRITICAL_TEMP=85           # NVMe critical temperature in Celsius

# Safe default settings (applied during shutdown)
SAFE_CPU_STATE=2                # Medium CPU fan speed on service stop
SAFE_NVME_DUTY=16000            # 40% NVMe fan speed on service stop
